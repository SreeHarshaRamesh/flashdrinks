<!--
  This template loads for the 'tab.friend-detail' state (app.js)
  'friend' is a $scope variable created in the FriendsCtrl controller (controllers.js)
  The FriendsCtrl pulls data from the Friends service (service.js)
  The Friends service returns an array of friend data
-->
<ion-view view-title="{{::bar.name}} ({{bar.sync.count}})">
  <ion-content class="padding">
    <img ng-src="{{::bar.icon}}" style="width: 64px; height: 64px">
    <!--<p>{{::bar.description}}</p>-->
    <a class="button button-full" ng-class="{'button-assertive': bar.sync.members[user.$id], 'button-balanced': !bar.sync.members[user.$id]}" ng-click="Bars.opt(bar)">
      {{bar.sync.members[user.$id] ? "I'm out" : "I'm in"}}
    </a>

    <div class="list card">

      <div class="item item-divider">
        Chat
      </div>

      <form class="item" novalidate ng-submit="Bars.chat(user, bar, text);text=''">
        <label class="item item-input">
          <textarea placeholder="Chat Message" ng-model="text"></textarea>
        </label>
        <input type='submit' class="button button-block button-positive" value="Submit" />
      </form>

      <div class="item item-thumbnail-left item-text-wrap" ng-repeat="chat in bar.sync.chat | toArray | orderBy:'-timestamp'" ng-init="profile=$firebase(ref.users.child(chat.uid)).$asObject()">
        <img ng-src='{{profile.picture}}' ui-sref="tab.friend-detail({friendId:profile.$id})" />
        <h2>{{profile.name}}</h2>
        <p>{{::chat.text}}</p>
      </div>
    </div>

  </ion-content>
</ion-view>
